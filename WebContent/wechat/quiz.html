<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<title> 平安校园安全教育平台 </title>
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<!-- Basic Styles -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome.min.css">
		<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production-plugins.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-skins.min.css">
		<!-- SmartAdmin RTL Support  -->
		<link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-rtl.min.css">
		<link rel="stylesheet" type="text/css" media="screen" href="css/demo.min.css">
		<!-- FAVICONS -->
		<link rel="shortcut icon" href="img/favicon/favicon.ico" type="image/x-icon">
		<link rel="icon" href="img/favicon/favicon.ico" type="image/x-icon">
		<!-- GOOGLE FONT -->
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700">
		<!-- Specifying a Webpage Icon for Web Clip 
			 Ref: https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html -->
		<link rel="apple-touch-icon" href="img/splash/sptouch-icon-iphone.png">
		<link rel="apple-touch-icon" sizes="76x76" href="img/splash/touch-icon-ipad.png">
		<link rel="apple-touch-icon" sizes="120x120" href="img/splash/touch-icon-iphone-retina.png">
		<link rel="apple-touch-icon" sizes="152x152" href="img/splash/touch-icon-ipad-retina.png">
	</head>
	<body class="">
		<!-- HEADER -->
		<header id="header">
			<div id="logo-group">
				<!-- PLACE YOUR LOGO HERE -->
				<span id="logo"> <img src="img/logo.png" alt="SmartAdmin"> </span>		
			</div>
			<!-- pulled right: nav area -->
			<div class="pull-right">
				<!-- collapse menu button -->
				<div id="hide-menu" class="btn-header pull-right">
					<span> <a href="javascript:void(0);" data-action="toggleMenu" title="Collapse Menu"><i class="fa fa-reorder"></i></a> </span>
				</div>
				<!-- end collapse menu -->
			</div>
			<!-- end pulled right: nav area -->
		</header>
		<!-- END HEADER -->
		<!-- Left panel : Navigation area -->
		<aside id="left-panel">
			<!-- NAVIGATION : This navigation is also responsive-->
			<nav>
				<ul>
					<li>
						<a href="index.html" title="Dashboard"><i class="fa fa-lg fa-fw fa-home"></i> <span class="menu-item-parent">首页</span></a>
					</li>
					<li class="active">
						<a href="courselist.html"><i class="fa fa-lg fa-fw fa-video-camera"></i> <span class="menu-item-parent">视频学习</span></a>
					</li>
					<li>
						<a href="simulatel.html"><i class="fa fa-lg fa-fw fa-file-text"></i> <span class="menu-item-parent">模拟考试</span></a>
					</li>
					<li>
						<a href="formall.html"><i class="fa fa-lg fa-fw fa-file-text-o"></i> <span class="menu-item-parent">正式考试</span></a>
					</li>
				</ul>
			</nav>
			<span class="minifyme" data-action="minifyMenu"> 
				<i class="fa fa-arrow-circle-left hit"></i> 
			</span>

		</aside>
		<!-- END NAVIGATION -->
		<!-- MAIN PANEL -->
		<div id="main" role="main">
			<div id="ribbon">
				<span class="ribbon-button-alignment"> 
					<span id="refresh" class="btn btn-ribbon" onclick="self.location=document.referrer;">
						<i class="fa fa-arrow-left"></i>后退
					</span> 
				</span>

				<!-- breadcrumb -->
				<ol class="breadcrumb">
					<li>主页</li><li>开始考试</li>
				</ol>
				<!-- end breadcrumb -->

				<!-- You can also add more buttons to the
				ribbon for further usability

				Example below:

				<span class="ribbon-button-alignment pull-right">
				<span id="search" class="btn btn-ribbon hidden-xs" data-title="search"><i class="fa-grid"></i> Change Grid</span>
				<span id="add" class="btn btn-ribbon hidden-xs" data-title="add"><i class="fa-plus"></i> Add</span>
				<span id="search" class="btn btn-ribbon" data-title="search"><i class="fa-search"></i> <span class="hidden-mobile">Search</span></span>
				</span> -->

			</div>
			<!-- MAIN CONTENT -->
			<div id="content">
				<!-- NEW WIDGET START -->
					<article class="col-sm-12 col-md-12 col-lg-10">
								<!-- Widget ID (each widget will need unique ID)-->
								<div class="jarviswidget" id="wid-id-0" data-widget-colorbutton="false" data-widget-editbutton="false">
									<header>
										<span class="widget-icon"> <i class="fa fa-eye"></i> </span>
										<h2>试题列表</h2>
									</header>
									<!-- widget div-->
									<div class="widget-body">						
									<!-- widget content -->
									<form class="smart-form" id="questionlist">									
									</form>
									<div class="form-actions">
										<div class="well">
										<div class="btn-group btn-group-justified">
											<a href="javascript:void(0);" class="btn btn-default">上一页</a>
											<a href="javascript:void(0);" class="btn btn-default">下一页</a>
										</div>
										</div>
										<div class="row">
											<div class="col-md-12">
												<button class="btn btn-block"  type="button" onclick=submit();>提交</button>
											</div>
										</div>
									</div>
									<!-- end widget content -->
									</div>
									<!-- end widget div -->
								</div>
								<!-- end widget -->
							</article>
			</div>
			<!-- END MAIN CONTENT -->
		</div>
		<!-- END PAGE FOOTER -->
		<!-- END MAIN PANEL -->
		<script data-pace-options='{ "restartOnRequestAfter": true }' src="js/plugin/pace/pace.min.js"></script>
	    <script src="js/libs/jquery-2.1.1.min.js"></script>
	    <script src="js/libs/jquery-ui-1.10.3.min.js"></script>
		<script src="js/app.config.js"></script>
		<script src="js/plugin/jquery-touch/jquery.ui.touch-punch.min.js"></script> 
		<script src="js/bootstrap/bootstrap.min.js"></script>
		<script src="js/app.min.js"></script>
		<script src="js/bootstrap-treeview.js"></script>
		<script type="text/javascript">
		// DO NOT REMOVE : GLOBAL FUNCTIONS!
		var reg = new RegExp("(^|&)quizid=([^&]*)(&|$)", "i");  
	    var r = window.location.search.substr(1).match(reg);
	    var quizid=r[2];
	    reg = new RegExp("(^|&)gid=([^&]*)(&|$)", "i"); 
	    r = window.location.search.substr(1).match(reg);
	    var gid=r[2];
	    var questions;
	    var curpages=1;
	    $.post("GetQuiz",
	    			{
	    				quizid:quizid,
	    				gid:gid
					},
						function(data){
		    				questions=data;
		    				loadquestions();
					}
			);
		
		function loadquestions()
		{
			var html="";
			var opt="";
			var questions=data;
			for(i=0;i<questions.length;i++)
			{
				var question = document.createElement('fieldset'); //创建元素
				question.id=questions[i].id;
				var id=questions[i].id;
				var text=questions[i].text;
				var choices=questions[i].choices;
				var type=questions[i].type;
				var answer=questions[i].answer;
				var html="<div class='row'>";
				if(type=="check")
				{
					html=html+"<section class='col col-md-2'><label class='label'>[判断]"+text+"</label><div class='row'><div class='col col-4'><label class='toggle'><input type='checkbox' name='checkbox-toggle'><i data-swchon-text='正确' data-swchoff-text='错误'></i>选项：</label></div></div></section></div>";
				}
				else
				if(type=="single")
					{
						html=html+"<section class='col col-md-2'><label class='label'>[单选]"+text+"</label></section></div>";
						html=html+"<section class='singlechoice'><label class='label'>选项：</label><div class='row'><div class='col col-4'>";
						var optarr=choices.split('|');
						opt="";
						for(j=0;j<optarr.length;j++)
						{
							opt=opt+"<label class='radio'><input type='radio' name='single"+id+"'><i></i>"+optarr[j]+"</label>";
						}
						html=html+opt;
						html=html+"</div></div></section>";
					}
				else
					{
						html=html+"<section class='col col-md-2'><label class='label'>[多选]"+text+"</label></section></div>";	
						html=html+"<section class='multychoice'><label class='label'>选项：</label><div class='row'><div class='col col-4'>";
						var optarr=choices.split('|');
						opt="";
						for(j=0;j<optarr.length;j++)
						{
							opt=opt+"<div class='checkbox'><label><input type='checkbox' class='checkbox style-0' name='multy"+id+"'><span>"+optarr[j]+"</span></label></div>";
						}
						html=html+opt;
						html=html+"</div></div></section>";
					}
				question.innerHTML=html;
				var field = document.getElementById('questionlist'); //2、找到父级元素
				field.appendChild(question);//插入到最左边
			}
		}
		function submit()
		{
			var fieldlist=$("#questionlist").find("fieldset");
			console.log(fieldlist);
			var answers=[];
			
			var json="[";
			for(i=0;i<fieldlist.length;i++)
			{
				var answer={};
				var field=fieldlist[i];	
				var temp=field.innerText;
				var type=temp.slice(1,3);
				if(i>0)
					json=json+",";
				answer.id=field.id;
				if(type=="判断")
				{
					var temp=field.childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes[0].childNodes[0].checked;
					if(temp)
						answer.answer="1";
					else
						answer.answer="0";
				}
				else
					if(type=="单选")
						{
							if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[0].childNodes[0].checked)
								answer.answer="A";
							else
								if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[1].childNodes[0].checked)
									answer.answer="B";
								else
									if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[2].childNodes[0].checked)
										answer.answer="C";
									else
										answer.answer="D";
						}
					else
					{
						answer.answer="";
						if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[0].childNodes[0].childNodes[0].checked)
							answer.answer=answer.answer+"A";
						if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[1].childNodes[0].childNodes[0].checked)
							answer.answer=answer.answer+"B";
						if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[2].childNodes[0].childNodes[0].checked)
							answer.answer=answer.answer+"C";
						if(field.childNodes[1].childNodes[1].childNodes[0].childNodes[3].childNodes[0].childNodes[0].checked)
							answer.answer=answer.answer+"D";
					}
				console.log(answer);
				answers.push(answer);
			}
			var st = JSON.stringify(answers);
			$.post("SubmitCourseQuestions",
					{
						courseid:courseid,
						answers:st
					},
					function(data){
						if(data=="wrong")
							alert("答案有误，请检查");
						else
							if(data=="success")
								{
									alert("恭喜你完成本节课程");
									window.location.href="courselist.html";
								}
							else
								console.log(data);
					}
				);			
		}
		</script>
	</body>

</html>